(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{63:(e,t,a)=>{"use strict";var l=a(7260);a.o(l,"useParams")&&a.d(t,{useParams:function(){return l.useParams}}),a.o(l,"usePathname")&&a.d(t,{usePathname:function(){return l.usePathname}}),a.o(l,"useRouter")&&a.d(t,{useRouter:function(){return l.useRouter}}),a.o(l,"useSearchParams")&&a.d(t,{useSearchParams:function(){return l.useSearchParams}})},1316:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var l=a(5155),r=a(2115),n=a(1847);let s=(0,n.A)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),i=(0,n.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var o=a(1433);let d="backtester.favoriteSymbols",c=["BTC","ETH","SOL","HYPE"];function u(e){let{value:t,onChange:a,availableSymbols:n}=e,[u,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)(""),[g,f]=(0,r.useState)(c),p=(0,r.useRef)(null),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{function e(e){p.current&&!p.current.contains(e.target)&&(m(!1),h(""))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,r.useEffect)(()=>{let e=window.localStorage.getItem(d);if(e)try{let t=JSON.parse(e);if(Array.isArray(t)){let e=Array.from(new Set(t.map(e=>"string"==typeof e?e.toUpperCase():"").filter(e=>e&&n.includes(e))));e.length>0&&f(e)}}catch(e){console.warn("Failed to parse favorite symbols from storage",e)}},[]),(0,r.useEffect)(()=>{f(e=>{let t=e.filter(e=>n.includes(e));return t.length===e.length&&t.every((t,a)=>t===e[a])?e:t})},[n]),(0,r.useEffect)(()=>{window.localStorage.setItem(d,JSON.stringify(g))},[g]);let v=e=>{let t=e.toUpperCase();n.includes(t)&&f(e=>e.includes(t)?e.filter(e=>e!==t):[t,...e])},y=n.filter(e=>e.toUpperCase().startsWith(x.toUpperCase())),w=g.filter(e=>y.includes(e)),j=y.filter(e=>!g.includes(e)),N=t&&g.includes(t.toUpperCase()),S=(e,r)=>(0,l.jsxs)("button",{type:"button",onClick:()=>{a(e),m(!1),h("")},className:(0,o.cn)("w-full px-3 py-2 text-left hover:bg-[#252525] transition-colors flex items-center gap-2",t===e&&"bg-[#2a2e39] text-primary"),children:[(0,l.jsx)("span",{className:"font-medium",children:e}),(0,l.jsx)("span",{className:"ml-auto"}),(0,l.jsx)("span",{role:"button",tabIndex:0,"aria-label":r?"Remove ".concat(e," from favorites"):"Add ".concat(e," to favorites"),className:"p-1 -mr-1 rounded transition-colors hover:bg-[#2a2e39]",onClick:t=>{t.preventDefault(),t.stopPropagation(),v(e)},onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),v(e))},children:(0,l.jsx)(s,{className:"w-3.5 h-3.5",stroke:r?"#FFB800":"#666",fill:r?"#FFB800":"transparent"})})]},e);return(0,l.jsxs)("div",{className:"relative",ref:p,children:[(0,l.jsxs)("button",{type:"button",onClick:()=>{m(!0),setTimeout(()=>{var e;null==(e=b.current)||e.focus()},0)},className:"w-full h-10 bg-[#1a1d24] border border-[#2a2e39] rounded-md text-white px-3 text-left focus:outline-none focus:border-[#375a7f] hover:bg-[#1f2229] transition-colors flex items-center justify-between",children:[(0,l.jsxs)("span",{className:"flex items-center gap-2",children:[t||"Select symbol...",t&&N&&(0,l.jsx)(s,{className:"w-3 h-3",stroke:"#FFB800",fill:"#FFB800"})]}),(0,l.jsx)(i,{className:"w-4 h-4 text-[#666]"})]}),u&&(0,l.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-[#1a1d24] border border-[#2a2e39] rounded-md shadow-lg max-h-[400px] flex flex-col z-50",children:[(0,l.jsx)("div",{className:"p-2 border-b border-[#2a2e39]",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(i,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[#666]"}),(0,l.jsx)("input",{ref:b,type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Search symbols...",className:"w-full h-8 bg-background border border-[#2a2e39] rounded text-white pl-8 pr-3 text-sm focus:outline-none focus:border-[#375a7f]"})]})}),(0,l.jsxs)("div",{className:"overflow-y-auto max-h-[350px]",children:[w.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"px-3 py-1.5 text-xs text-[#888] uppercase tracking-wider font-semibold bg-background sticky top-0",children:"Favorites"}),w.map(e=>S(e,!0))]}),j.length>0&&(0,l.jsxs)("div",{children:[w.length>0&&(0,l.jsx)("div",{className:"px-3 py-1.5 text-xs text-[#888] uppercase tracking-wider font-semibold bg-background sticky top-0 border-t border-[#2a2e39]",children:"All Symbols"}),j.map(e=>S(e,!1))]}),0===y.length&&(0,l.jsx)("div",{className:"px-3 py-4 text-center text-[#666] text-sm",children:"No symbols found"})]})]})]})}},1385:(e,t,a)=>{"use strict";async function l(e){let t=new URLSearchParams({symbol:e.symbol});e.start&&t.set("start",e.start),e.end&&t.set("end",e.end),e.exchanges&&"all"!==e.exchanges&&t.set("exchanges",e.exchanges);let a="/api/funding/historical?".concat(t.toString());try{let e=await fetch(a,{next:{revalidate:0}});if(!e.ok)throw Error("Failed to fetch historical data: ".concat(e.statusText));return await e.json()}catch(t){return console.error("Error fetching historical funding rates:",t),{symbol:e.symbol,series:{}}}}a.d(t,{r:()=>l})},1433:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var l=a(2821),r=a(5889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,l.$)(t))}},2355:(e,t,a)=>{"use strict";a.d(t,{default:()=>M});var l=a(5155),r=a(2115),n=a(63);function s(e){return e.includes("_1_perp")?e:"".concat(e,"_1_perp")}function i(e,t){return new Date(e).getTime()-new Date(t).getTime()}var o=a(9776),d=a(1385),c=a(1316),u=a(5239),m=a(4033);function x(e){let{exchanges:t,value:a,onChange:n}=e,[s,i]=(0,r.useState)(!1),o=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{o.current&&!o.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let d=t.find(e=>e.name.split("_")[0]===a),c=d?d.name.split("_")[0]:a;return(0,l.jsxs)("div",{className:"relative",ref:o,children:[(0,l.jsxs)("button",{type:"button",onClick:()=>i(e=>!e),className:"w-full h-10 bg-[#1a1d24] border border-[#2a2e39] rounded-md text-white px-3 text-left focus:outline-none focus:border-[#375a7f] hover:bg-[#1f2229] transition-colors flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[c&&(0,l.jsx)(u.default,{src:"/images/exchanges/".concat(c,".png"),alt:(null==d?void 0:d.display)||c,width:16,height:16,className:"rounded"}),(0,l.jsx)("span",{children:(null==d?void 0:d.display)||a||"Select exchange..."})]}),(0,l.jsx)(m.A,{className:"w-4 h-4 text-[#666] ".concat(s?"rotate-180":"")})]}),s&&(0,l.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-[#1a1d24] border border-[#2a2e39] rounded-md shadow-lg max-h-80 overflow-y-auto z-50",children:t.map(e=>{let t=e.name.split("_")[0],r=t===a;return(0,l.jsxs)("button",{type:"button",onClick:()=>{n(t),i(!1)},className:"w-full px-3 py-2 text-left hover:bg-[#252525] transition-colors flex items-center gap-2 ".concat(r?"bg-[#2a2e39] text-primary":""),children:[(0,l.jsx)(u.default,{src:"/images/exchanges/".concat(t,".png"),alt:e.display,width:16,height:16,className:"rounded"}),(0,l.jsx)("span",{className:"font-medium",children:e.display})]},e.name)})})]})}var h=a(3392),g=a(9340);let f=(0,a(1847).A)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);var p=a(3327),b=a(1433),v=a(4381);function y(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(e)}function w(e){return Number(e.replace(/,/g,""))||0}function j(e){let{symbol:t,exchange1:a,exchange2:n,timeframe:s,positionSize:i,executionCost:o,displayUnit:d,availableSymbols:u,availableExchanges:m,onSimulate:j,isSimulating:N,onSymbolChange:S,onExchange1Change:k,onExchange2Change:C,onTimeframeChange:P,onCustomRangeChange:L,onPositionSizeChange:D,onExecutionCostChange:R,onDisplayUnitChange:A,needsRefresh:E=!1}=e,[F,M]=(0,r.useState)(y(i)),[T,B]=(0,r.useState)(o.toString());(0,r.useEffect)(()=>{M(y(i))},[i]),(0,r.useEffect)(()=>{B(o.toString())},[o]);let U=m.map(e=>({name:"".concat(e.name,"_1_perp"),display:e.display,interval:8}));return(0,l.jsxs)("div",{className:"bg-linear-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-2.5 lg:p-3 shadow-xl h-full flex flex-col overflow-hidden",children:[(0,l.jsxs)("h2",{className:"text-xs lg:text-sm font-semibold text-white mb-1 shrink-0 flex items-center gap-1.5",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"Backtest Inputs"]}),(0,l.jsxs)("div",{className:"space-y-2 flex-1 flex flex-col min-h-0 overflow-y-auto",children:[(0,l.jsxs)("div",{className:"shrink-0 flex flex-col sm:flex-row gap-1.5",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-xs text-[#cfd3dc] mb-0.5 font-medium",children:"Token"}),(0,l.jsx)(c.A,{value:t,onChange:e=>{S&&S(e)},availableSymbols:u})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[(0,l.jsx)("label",{className:"text-xs text-[#cfd3dc] font-medium",children:"Time Range"}),(0,l.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{A&&A("BPS")},className:(0,b.cn)("px-2 py-0.5 text-[11px] leading-none font-medium rounded-md border transition-colors","BPS"===d?"bg-[#2a2a2a] border-[#444] text-white":"bg-[#151515] border-[#2a2e39] text-[#cfd3dc] hover:border-[#374151]"),children:"BPS"}),(0,l.jsx)("button",{type:"button",onClick:()=>{A&&A("APY")},className:(0,b.cn)("px-2 py-0.5 text-[11px] leading-none font-medium rounded-md border transition-colors","APY"===d?"bg-[#2a2a2a] border-[#444] text-white":"bg-[#151515] border-[#2a2e39] text-[#cfd3dc] hover:border-[#374151]"),children:"APY"})]})]}),(0,l.jsx)(v.A,{value:s,onChange:e=>{P&&P(e)},onCustomRangeChange:L,exclude:["4h","12h","3d","14d","all"]})]})]}),(0,l.jsxs)("div",{className:"shrink-0 flex items-end gap-1.5",children:[(0,l.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,l.jsx)("span",{className:"block text-xs text-primary font-semibold uppercase tracking-wide",children:"Long"}),(0,l.jsx)(x,{exchanges:U,value:a,onChange:e=>{k&&k(e)}})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{k&&C&&(k(n),C(a))},className:"h-10 px-3 rounded-md bg-linear-to-br from-[#2a2e39] to-[#1f2229] border border-[#374151] text-[#cfd3dc] hover:border-primary hover:text-primary transition-all duration-200 flex items-center justify-center group shadow-sm shrink-0",title:"Switch exchanges",children:(0,l.jsx)(f,{className:"w-4 h-4 group-hover:rotate-180 transition-transform duration-300"})}),(0,l.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,l.jsx)("span",{className:"block text-xs text-[#ef476f] font-semibold uppercase tracking-wide text-right",children:"Short"}),(0,l.jsx)(x,{exchanges:U,value:n,onChange:e=>{C&&C(e)}})]})]}),(0,l.jsxs)("div",{className:"shrink-0 flex flex-col sm:flex-row gap-1.5",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-xs text-[#cfd3dc] mb-0.5 font-medium",children:"Position Size (USD)"}),(0,l.jsx)(h.p,{type:"text",value:F,onChange:e=>{let t=e.target.value.replace(/,/g,""),a=w(t);M(t),D&&D(a)},onBlur:()=>{M(y(w(F)))},placeholder:"25,000",className:"w-full"})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("label",{className:"flex text-xs text-[#cfd3dc] mb-0.5 font-medium items-center gap-1.5 whitespace-nowrap",children:["Execution Cost (bps per leg)",(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)(p.A,{className:"w-3 h-3 text-[#666] cursor-help hover:text-[#888] transition-colors"}),(0,l.jsx)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-50 pointer-events-none",children:(0,l.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2e39] rounded-lg p-3 shadow-xl text-xs text-[#cfd3dc] w-[280px] whitespace-normal",children:[(0,l.jsx)("div",{className:"font-semibold mb-2 text-white",children:"All-in execution cost"}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("div",{children:"Includes slippage + fees"}),(0,l.jsx)("div",{className:"text-[#888]",children:"Applied per leg (both legs, open & close)"}),(0,l.jsxs)("div",{className:"text-[#888] mt-2 pt-2 border-t border-[#2a2e39] font-medium",children:["Total: ",4*o," bps"]})]})]})})]})]}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row gap-1.5 lg:items-end",children:[(0,l.jsx)("div",{className:"relative flex-1",children:(0,l.jsx)(h.p,{type:"number",value:T,onChange:e=>{let t=e.target.value;B(t);let a=Number(t)||0;R&&R(Math.max(0,a))},onBlur:()=>{let e=Math.max(0,2.5*Math.round((Number(T)||0)/2.5));B(e.toString()),R&&R(e)},placeholder:"10",min:"0",step:"2.5",className:"w-full"})}),(0,l.jsx)("div",{className:"flex gap-1 shrink-0",children:[10,25,50].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>{R&&R(e)},className:(0,b.cn)("px-2 py-1.5 text-[11px] rounded border transition-colors whitespace-nowrap",o===e?"bg-primary/20 border-primary text-primary font-medium":"bg-[#1a1a1a] border-[#2a2e39] text-[#cfd3dc] hover:border-[#374151]"),children:e},e))})]})]})]})]}),(0,l.jsxs)("div",{className:"shrink-0 mt-auto pt-1",children:[(0,l.jsx)(g.$,{onClick:()=>{j({symbol:t,exchange1:a,exchange2:n,timeframe:s,positionSize:w(F),executionCost:o})},disabled:N,variant:"primary",size:"lg",className:"w-full shadow-lg shadow-primary/20 hover:shadow-primary/40 transition-all duration-200 font-semibold",children:N?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"inline-block animate-spin mr-2",children:"⟳"}),"Running Backtest..."]}):"Run Backtest"}),E&&!N&&(0,l.jsx)("p",{className:"text-xs text-[#888] mt-1.5 text-center",children:"Press to fetch data for the new exchange combination"})]})]})}var N=a(1607);function S(e){return 3*e*365/100}function k(e){let{data:t,exchange1Name:a,exchange2Name:n,isLoading:s=!1,hasBothExchanges:i=!0,displayUnit:o="BPS"}=e,d=(0,r.useRef)(null),c=(0,r.useRef)(null);return((0,r.useEffect)(()=>{if(!d.current||s||(c.current&&(c.current.destroy(),c.current=null),!t.timestamps||0===t.timestamps.length||!t.exchange1Rates||!t.exchange2Rates||!t.spreads))return;let e=[...t.timestamps].sort(),l=null,r=null;if(e.length>0){let t=e.map(e=>new Date(e)).filter(e=>!isNaN(e.getTime()));t.length>0&&(l=new Date(Math.min(...t.map(e=>e.getTime()))),r=new Date(Math.max(...t.map(e=>e.getTime()))))}let i=l&&r?r.getTime()-l.getTime():864e5,u=new Map,m=new Map,x=new Map;t.timestamps.forEach((e,a)=>{let l="APY"===o?S(t.exchange1Rates[a]):t.exchange1Rates[a],r="APY"===o?S(t.exchange2Rates[a]):t.exchange2Rates[a],n="APY"===o?S(t.spreads[a]):t.spreads[a];u.set(e,l),m.set(e,r),x.set(e,n)});let h="".concat(a.toUpperCase()," • Long"),g="".concat(n.toUpperCase()," • Short"),f=e.map(e=>{var t;return null!=(t=x.get(e))?t:null}),p=f.map(e=>null===e?"rgba(148,163,184,0.28)":e>=0?"rgba(0,229,175,0.28)":"rgba(239,71,111,0.28)"),b=f.map(e=>null===e?"#2f3944":e>=0?"#00e5af":"#ef476f"),v=[{type:"line",label:h,data:e.map(e=>{var t;return null!=(t=u.get(e))?t:null}),borderColor:"#00e5af",backgroundColor:"rgba(0,229,175,0.08)",yAxisID:"yLeft",borderWidth:2,pointRadius:0,pointHoverRadius:4,tension:.1,spanGaps:!0},{type:"line",label:g,data:e.map(e=>{var t;return null!=(t=m.get(e))?t:null}),borderColor:"#ef476f",backgroundColor:"rgba(239,71,111,0.08)",yAxisID:"yLeft",borderWidth:2,pointRadius:0,pointHoverRadius:4,tension:.1,spanGaps:!0},{type:"bar",label:"Spread (Short - Long)",data:f,backgroundColor:p,borderColor:b,borderWidth:0,yAxisID:"yRight",barPercentage:.9,categoryPercentage:1}],y=d.current.getContext("2d");if(y)return c.current=new N.t1(y,{type:"line",data:{labels:e,datasets:v},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,right:15,left:10,bottom:15}},animation:!1,interaction:{mode:"index",intersect:!1},scales:{x:{type:"time",time:{unit:i<=1728e5?"hour":i<=12096e5?"day":i<=7776e6?"week":"month",displayFormats:{hour:"MMM DD, HH:mm",day:"MMM DD",week:"MMM DD",month:"MMM YYYY"}},ticks:{maxRotation:0,color:"#cfd3dc",autoSkip:!0,maxTicksLimit:8,font:{size:11},callback:function(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("en-GB",{timeZone:"UTC",hour12:!1,month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}},grid:{color:"#2c3540"},border:{display:!1},title:{display:!0,text:"Date (UTC)",color:"#cfd3dc"},min:null==l?void 0:l.toISOString(),max:null==r?void 0:r.toISOString(),bounds:"data",offset:!1},yLeft:{type:"linear",position:"left",title:{display:!0,text:"APY"===o?"Funding Rate (APY %)":"Funding Rate (bps)",color:"#cfd3dc",font:{size:12,weight:"normal"}},ticks:{color:"#cfd3dc",font:{size:11}},grid:{color:e=>0===e.tick.value?"#3d4955":"#2c3540",lineWidth:e=>0===e.tick.value?2:1},border:{display:!1}},yRight:{type:"linear",position:"right",title:{display:!0,text:"APY"===o?"Spread (APY %)":"Spread (bps)",color:"#cfd3dc",font:{size:12,weight:"normal"}},ticks:{color:"#cfd3dc",font:{size:11}},grid:{drawOnChartArea:!1,color:e=>0===e.tick.value?"#3d4955":"#2c3540",lineWidth:e=>0===e.tick.value?2:1},border:{display:!1}}},plugins:{legend:{position:"top",align:"start",labels:{color:"#cfd3dc",boxWidth:10,boxHeight:10,usePointStyle:!0,padding:8,generateLabels:e=>N.t1.defaults.plugins.legend.labels.generateLabels(e).map((e,t)=>{var a;return 2===t&&(null==(a=e.text)?void 0:a.toLowerCase().includes("spread"))?{...e,fillStyle:"#9ca3af",strokeStyle:"#9ca3af"}:e})}},tooltip:{backgroundColor:"rgba(17, 24, 39, 0.95)",titleColor:"#f3f4f6",bodyColor:"#d1d5db",borderColor:"#2f3944",borderWidth:1,padding:12,displayColors:!0,intersect:!1,mode:"index",bodyFont:{family:"ui-monospace, monospace",size:12},titleFont:{family:"ui-sans-serif, system-ui",size:12,weight:"normal"},callbacks:{title:e=>{if(!e||!e.length)return"";let t=e[0].parsed.x;if(null===t||"number"!=typeof t)return"";let a=new Date(t);return i&&i<=1728e5?a.toLocaleString("en-GB",{timeZone:"UTC",hour12:!1,month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}):a.toLocaleString("en-GB",{timeZone:"UTC",month:"short",day:"2-digit",year:"numeric"})},label:e=>{let t=e.parsed.y;if(null==t)return"";let a=e.dataset.label||"",l=t.toFixed("APY"===o?2:1),r="APY"===o?"%":"bps";if(a.includes("Spread")){let e=t>=0?"+":"";return"".concat(a,": ").concat(e).concat(l," ").concat(r)}return"".concat(a,": ").concat(l," ").concat(r)}}}}}}),()=>{c.current&&(c.current.destroy(),c.current=null)}},[t,a,n,s,o]),s)?(0,l.jsxs)("div",{className:"bg-linear-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl lg:h-full lg:flex lg:flex-col",children:[(0,l.jsx)("div",{className:"mb-2 shrink-0",children:(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"Funding Rates & Spread"]})}),(0,l.jsx)("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-5 h-5 border-2 border-[#cfd3dc] border-t-transparent rounded-full animate-spin"}),(0,l.jsx)("div",{className:"text-[#cfd3dc] text-sm",children:"Loading chart data..."})]})})]}):i&&t.timestamps&&0!==t.timestamps.length&&t.exchange1Rates&&t.exchange2Rates&&t.spreads?(0,l.jsxs)("div",{className:"bg-linear-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl h-full flex flex-col",children:[(0,l.jsx)("div",{className:"mb-2 shrink-0",children:(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"Funding Rates & Spread"]})}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)("canvas",{ref:d,style:{background:"#161616",width:"100%",height:"100%"}})})]}):(0,l.jsxs)("div",{className:"bg-linear-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl lg:h-full lg:flex lg:flex-col",children:[(0,l.jsx)("div",{className:"mb-2 shrink-0",children:(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-1 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"Funding Rates & Spread"]})}),(0,l.jsx)("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-[#888] text-sm mb-2",children:"No data available"}),(0,l.jsx)("div",{className:"text-[#666] text-xs max-w-md",children:(0,l.jsxs)(l.Fragment,{children:["Run a backtest to see funding rates as line charts and spread as bars.",(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"text-primary",children:"Green bars"})," ","= ",n," funding higher than ",a,(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"text-[#ef476f]",children:"Red bars"})," ","= ",a," funding higher than ",n]})})]})})]})}function C(e){return Number.isFinite(e)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e):"$0.00"}function P(e){var t;let{stats:a,isLoading:r=!1,hasBothExchanges:n=!0,displayUnit:s="BPS"}=e,i=a.totalPnL>0?"text-[#00e5af]":a.totalPnL<0?"text-[#ef476f]":"text-[#cfd3dc]";return r?(0,l.jsxs)("div",{className:"bg-gradient-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl h-full",children:[(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"PnL Summary"]}),(0,l.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"h-3 bg-[#2a2e39] rounded w-20 animate-pulse"}),(0,l.jsx)("div",{className:"h-5 bg-[#2a2e39] rounded w-28 animate-pulse"})]},e))})]}):n&&a&&(Number.isFinite(a.totalPnL)||Number.isFinite(a.totalPnLPercent))?(0,l.jsxs)("div",{className:"bg-gradient-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl h-full flex flex-col",children:[(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-3 flex-shrink-0 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"PnL Summary"]}),(0,l.jsxs)("div",{className:"mb-4 pb-4 border-b border-[#2a2e39] flex-shrink-0",children:[(0,l.jsx)("div",{className:"text-xs text-[#888] mb-2 uppercase tracking-wider font-medium",children:"Total PnL"}),(0,l.jsxs)("div",{className:"flex items-baseline gap-2 lg:gap-3",children:[(0,l.jsx)("div",{className:"text-3xl lg:text-4xl font-bold ".concat(i),children:C(a.totalPnL)}),(0,l.jsx)("div",{className:"text-lg lg:text-xl font-semibold ".concat(i),children:function(e){if(!Number.isFinite(e))return"0.00%";let t=e>0?"+":"";return"".concat(t).concat(e.toFixed(2),"%")}(a.totalPnLPercent)})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2.5 flex-1",children:[(0,l.jsxs)("div",{className:"bg-[#1a1a1a]/50 border border-[#2a2e39]/50 rounded-lg p-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-xs text-[#888] uppercase tracking-wider font-medium",children:"Funding"}),(0,l.jsx)("div",{className:"text-sm lg:text-base font-bold text-[#00e5af]",children:C(a.totalFundingCollected)})]}),(0,l.jsxs)("div",{className:"bg-[#1a1a1a]/50 border border-[#2a2e39]/50 rounded-lg p-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-xs text-[#888] uppercase tracking-wider font-medium",children:"Costs"}),(0,l.jsx)("div",{className:"text-sm lg:text-base font-bold text-[#ef476f]",children:C(a.executionCosts)})]}),(0,l.jsxs)("div",{className:"bg-[#1a1a1a]/50 border border-[#2a2e39]/50 rounded-lg p-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-xs text-[#888] uppercase tracking-wider font-medium",children:"Periods"}),(0,l.jsx)("div",{className:"text-sm lg:text-base font-bold text-white",children:Number.isFinite(t=a.fundingPeriods)?Math.round(t).toString():"0"})]}),(0,l.jsxs)("div",{className:"bg-[#1a1a1a]/50 border border-[#2a2e39]/50 rounded-lg p-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-xs text-[#888] uppercase tracking-wider font-medium",children:"Avg Spread"}),(0,l.jsx)("div",{className:"text-sm lg:text-base font-bold text-white",children:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BPS";if(!Number.isFinite(e))return"APY"===t?"0.00%":"0.00 bps";if("APY"===t){let t=3*e*365/100;return"".concat(t.toFixed(2),"%")}return"".concat(e.toFixed(2)," bps")}(a.avgHourlySpread,s)})]})]})]}):(0,l.jsxs)("div",{className:"bg-gradient-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl lg:h-full lg:flex lg:flex-col",children:[(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"PnL Summary"]}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-[#888] text-sm mb-1",children:"No data available"}),(0,l.jsx)("div",{className:"text-[#666] text-xs",children:n?"Run a backtest to see results":"Both exchanges need data. Press Run Backtest to fetch."})]})})]})}function L(e){let{data:t,periodPnL:a,longLegCumulativePnL:n,shortLegCumulativePnL:s,exchange1Name:i,exchange2Name:o,isLoading:d=!1,hasBothExchanges:c=!0}=e,u=(0,r.useRef)(null),m=(0,r.useRef)(null);return((0,r.useEffect)(()=>{if(!u.current||d)return;m.current&&(m.current.destroy(),m.current=null);let e=t.map(e=>e.t),l=t.map(e=>e.pnl),r=864e5;if(e.length>0){let t=e.map(e=>new Date(e)).filter(e=>!isNaN(e.getTime()));if(t.length>0){let e=Math.min(...t.map(e=>e.getTime()));r=Math.max(...t.map(e=>e.getTime()))-e}}let c=u.current.getContext("2d");if(!c)return;let x=a?a.map(e=>e>=0?"rgba(0, 229, 175, 0.3)":"rgba(239, 71, 111, 0.3)"):[],h=a?a.map(e=>e>=0?"#00e5af":"#ef476f"):[],g=[];return g.push({type:"line",label:"Cumulative PnL ($)",data:l,borderColor:"#59a5ff",backgroundColor:"transparent",pointRadius:0,borderWidth:2,tension:.15,spanGaps:!0,order:1}),a&&a.length===t.length&&g.push({type:"bar",label:"Interval PnL ($)",data:a,backgroundColor:x,borderColor:h,borderWidth:1,barPercentage:.8,categoryPercentage:.9,order:2}),n&&n.length===e.length&&g.push({type:"line",label:"".concat((i||"Long").toUpperCase()," Leg PnL ($)"),data:n,borderColor:"#00e5af",backgroundColor:"transparent",pointRadius:0,borderWidth:2,borderDash:[5,5],tension:.15,spanGaps:!0,order:3,hidden:!0}),s&&s.length===e.length&&g.push({type:"line",label:"".concat((o||"Short").toUpperCase()," Leg PnL ($)"),data:s,borderColor:"#ef476f",backgroundColor:"transparent",pointRadius:0,borderWidth:2,borderDash:[5,5],tension:.15,spanGaps:!0,order:4,hidden:!0}),m.current=new N.t1(c,{type:"line",data:{labels:e,datasets:g},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},layout:{padding:{top:10,right:15,left:10,bottom:15}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{hour:"MMM DD HH:mm",day:"MMM DD",week:"MMM DD"}},ticks:{color:"#cfd3dc",maxRotation:0,autoSkip:!0,maxTicksLimit:15,callback:function(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("en-GB",{timeZone:"UTC",hour12:!1,month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}},grid:{color:"#2a2e39"},title:{display:!0,text:"Date (UTC)",color:"#cfd3dc"},bounds:"data",offset:!1,min:e.length>0?new Date(e[0]).toISOString():void 0,max:e.length>0?new Date(e[e.length-1]).toISOString():void 0},y:{title:{display:!0,text:"PnL (USD)",color:"#cfd3dc"},ticks:{color:"#cfd3dc"},grid:{color:e=>0===e.tick.value?"#6c757d":"#2a2e39",lineWidth:e=>0===e.tick.value?2:1}}},plugins:{legend:{position:"top",align:"start",labels:{boxWidth:10,boxHeight:10,usePointStyle:!0,padding:8,generateLabels:e=>e.data.datasets.map((t,a)=>({text:t.label||"",fillStyle:"bar"===t.type?"#9ca3af":t.borderColor,strokeStyle:"bar"===t.type?"#9ca3af":t.borderColor,fontColor:"#cfd3dc",lineWidth:2,hidden:!e.isDatasetVisible(a),datasetIndex:a,pointStyle:"circle"}))}},tooltip:{intersect:!1,position:"nearest",xAlign:"left",yAlign:"center",callbacks:{title:e=>{if(!e||!e.length)return"";let t=e[0].parsed.x;if(null===t)return"";let a=new Date(t);return r&&r<=1728e5?a.toLocaleString("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):a.toLocaleString("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})},label:e=>{let t=e.parsed.y;if(null==t)return"";let a=e.dataset.label||"";return"".concat(a,": $").concat(t.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2}))}}}}}}),()=>{m.current&&(m.current.destroy(),m.current=null)}},[t,a,n,s,i,o,d]),d)?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-5 h-5 border-2 border-[#cfd3dc] border-t-transparent rounded-full animate-spin"}),(0,l.jsx)("div",{className:"text-[#cfd3dc] text-sm",children:"Loading chart data..."})]})}):c&&t&&0!==t.length?(0,l.jsx)("canvas",{ref:u,style:{background:"#161616",width:"100%",height:"100%"}}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-[#888] text-sm mb-2",children:"No data available"}),(0,l.jsx)("div",{className:"text-[#666] text-xs",children:c?"Run backtest to see P&L chart":"Both exchanges need data. Press Run Backtest to fetch."})]})})}function D(e){var t;let a={"4h":144e5,"12h":432e5,"1d":864e5,"7d":6048e5,"14d":12096e5,"30d":2592e6,"90d":7776e6};return null!=(t=a[e])?t:a["7d"]}function R(e){return e.toISOString()}a(9363),N.t1.register(N.ZT,N.No,N.A6,N.E8,N.FN,N.kc,N.UA,N.hE,N.m_,N.s$,N.dN),N.t1.register(N.ZT,N.A6,N.No,N.E8,N.FN,N.kc,N.UA,N.hE,N.m_,N.s$);let A="backtester.positionSize",E="backtester.executionCost",F="backtester.displayUnit";function M(e){var t,a;let{initialExchanges:c,initialSymbols:u}=e,m=(0,n.useSearchParams)(),x=(0,o.jE)(),[h,g]=(0,r.useState)(()=>m.get("token")||"BTC"),[f,p]=(0,r.useState)(()=>m.get("exchange1")||"binance"),[b,v]=(0,r.useState)(()=>m.get("exchange2")||"bybit"),[y,w]=(0,r.useState)(()=>m.get("timeframe")||"7d"),[N,S]=(0,r.useState)(""),[C,M]=(0,r.useState)(""),[T,B]=(0,r.useState)(!1),U=e=>{let t=window.localStorage.getItem(e);if(!t)return;let a=Number(t);return Number.isFinite(a)?a:void 0},[_,I]=(0,r.useState)(()=>{let e=Number(m.get("position"));if(Number.isFinite(e)&&e>0)return e;let t=U(A);return"number"==typeof t&&t>0?t:25e3}),[Y,O]=(0,r.useState)(()=>{let e=Number(m.get("execution"));if(Number.isFinite(e)&&e>0)return e;let t=U(E);return"number"==typeof t&&t>0?t:10}),[z,H]=(0,r.useState)(()=>{let e=m.get("unit");if("BPS"===e||"APY"===e)return e;{let e=localStorage.getItem(F);if("BPS"===e||"APY"===e)return e}return"BPS"}),[W,G]=(0,r.useState)(!1),[$,Z]=(0,r.useState)(null),[q,J]=(0,r.useState)(null),[K,Q]=(0,r.useState)(null),[V,X]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=new URLSearchParams;"BTC"!==h&&e.set("token",h),"binance"!==f&&e.set("exchange1",f),"bybit"!==b&&e.set("exchange2",b),"7d"!==y&&e.set("timeframe",y),25e3!==_&&e.set("position",String(_)),10!==Y&&e.set("execution",String(Y)),"BPS"!==z&&e.set("unit",z);let t=e.toString(),a=t?"?".concat(t):window.location.pathname;window.history.replaceState({},"",a)},[h,f,b,y,_,Y,z]),(0,r.useEffect)(()=>{window.localStorage.setItem(A,String(_))},[_]),(0,r.useEffect)(()=>{window.localStorage.setItem(E,String(Y))},[Y]),(0,r.useEffect)(()=>{window.localStorage.setItem(F,z)},[z]);let ee=(0,r.useCallback)(async e=>{G(!0),Z(null);try{var t,a,l,r,n;let s,i,o=new Date;(null!=(l=null==e?void 0:e.isCustom)?l:T&&N&&C)?(i=null!=(r=null==e?void 0:e.start)?r:new Date(N).toISOString(),s=null!=(n=null==e?void 0:e.end)?n:new Date(C).toISOString()):(s=R(o),i=R(new Date(o.getTime()-D("30d"))));let c="".concat(f,"_1_perp,").concat(b,"_1_perp"),u=await x.fetchQuery({queryKey:["historical-funding",h,c,i,s],queryFn:()=>(0,d.r)({symbol:h,exchanges:c,start:i,end:s}),staleTime:3e5}),m=(null==(t=u.series)?void 0:t["".concat(f,"_1_perp")])||[],g=(null==(a=u.series)?void 0:a["".concat(b,"_1_perp")])||[];if(m.length+g.length===0)Z("No historical data available for this symbol and exchanges."),J(null),X(null);else{J(u),Z(null),X({start:i,end:s});let e=[f,b].sort().join(":");Q("".concat(h,":").concat(e))}}catch(e){console.error(e),Z(e instanceof Error?e.message:"Failed to fetch data."),J(null),X(null)}finally{G(!1)}},[h,f,b,x,T,N,C]);(0,r.useEffect)(()=>{h&&ee()},[h]);let et=(0,r.useMemo)(()=>{if(!q)return{filteredHistorical:null,simulationResult:null,periodPnL:[],hasBothExchanges:!1,chartData:{timestamps:[],exchange1Rates:[],exchange2Rates:[],spreads:[]},longLegCumulativePnL:[],shortLegCumulativePnL:[]};try{var e,t,a,l;let r,n,o=new Date;T&&N&&C?(n=new Date(N).toISOString(),r=new Date(C).toISOString()):(r=R(o),n=R(new Date(o.getTime()-D(y))));let d=function(e,t,a,l,r){var n,i;let o=new Date(l).getTime(),d=new Date(r).getTime(),c=s(t),u=s(a),m={},x=(null==(n=e.series)?void 0:n[c])||[],h=(null==(i=e.series)?void 0:i[u])||[];return m[c]=x.filter(e=>{let t=new Date(e.t).getTime();return t>=o&&t<=d}),m[u]=h.filter(e=>{let t=new Date(e.t).getTime();return t>=o&&t<=d}),{symbol:e.symbol,series:m}}(q,f,b,n,r),c={symbol:h,exchange1:f,exchange2:b,start:n,end:r,positionSizeUsd:_,executionCostBps:Y},u=function(e,t){var a,l;let{exchange1:r,exchange2:n,end:o,positionSizeUsd:d,executionCostBps:c}=e,u=(null==(a=t.series)?void 0:a[s(r)])||[],m=(null==(l=t.series)?void 0:l[s(n)])||[],x=new Map(u.map(e=>[e.t,e.y])),h=new Map(m.map(e=>[e.t,e.y])),g=Array.from(new Set([...x.keys(),...h.keys()])).filter(e=>x.has(e)&&h.has(e)).sort(i),f=c/1e4,p=d*f*2,b=d*f*2,v=g.map(e=>({t:e,e1bps:x.get(e),e2bps:h.get(e)})),y=v.length,w=v.reduce((e,t)=>e+t.e1bps,0),j=v.reduce((e,t)=>e+t.e2bps,0),N=y>0?w/y:0,S=y>0?j/y:0,k=N<=S?r:n,C=k===r?n:r,P=-p,L=[],D=0,R=0;for(let{t:e,e1bps:t,e2bps:a}of v){let l=a-t,r=l/1e4*d;D+=r,R+=l/1e4/8*100,P+=r,L.push({t:e,pnl:P})}let A=y>0?v[y-1].t:o;P-=b,L.push({t:A,pnl:P});let E=P,F=y>0?R/y:0;return{inputs:e,series:L,summary:{totalPnlUsd:E,totalPnlPct:d>0?E/d*100:0,fundingCollectedUsd:D,executionCostsUsd:p+b,numFundingPeriods:y,avgHourlySpreadPct:F,avgBpsExchange1:N,avgBpsExchange2:S,recommendedLong:k,recommendedShort:C}}}(c,d),m=[];if(u.series.length>0){m.push(u.series[0].pnl);for(let e=1;e<u.series.length;e++)m.push(u.series[e].pnl-u.series[e-1].pnl)}let x="".concat(f,"_1_perp"),g="".concat(b,"_1_perp"),p=(null==(e=d.series)?void 0:e[x])||[],v=(null==(t=d.series)?void 0:t[g])||[],w=p.length>0&&v.length>0,j=new Map(p.map(e=>[e.t,e.y])),S=new Map(v.map(e=>[e.t,e.y])),k=new Set([...p.map(e=>e.t),...v.map(e=>e.t)]),P=Array.from(k).sort(),L=P.map(e=>{var t;return null!=(t=j.get(e))?t:0}),A=P.map(e=>{var t;return null!=(t=S.get(e))?t:0}),E=P.map(e=>{let t=j.get(e),a=S.get(e);return void 0===t||void 0===a?0:a-t}),F=[],M=[],B=0,U=0;for(let e of P){let t=null!=(a=j.get(e))?a:0,r=null!=(l=S.get(e))?l:0,n=-(t/1e4)*_,s=r/1e4*_;B+=n,U+=s,F.push(B),M.push(U)}return F.length>0&&u.series.length===F.length+1&&(F.push(F[F.length-1]),M.push(M[M.length-1])),{filteredHistorical:d,simulationResult:u,periodPnL:m,hasBothExchanges:w,chartData:{timestamps:P,exchange1Rates:L,exchange2Rates:A,spreads:E},longLegCumulativePnL:F,shortLegCumulativePnL:M}}catch(e){return console.error("Error computing filtered data:",e),{filteredHistorical:null,simulationResult:null,periodPnL:[],hasBothExchanges:!1,chartData:{timestamps:[],exchange1Rates:[],exchange2Rates:[],spreads:[]},longLegCumulativePnL:[],shortLegCumulativePnL:[]}}},[q,f,b,y,_,Y,h,T,N,C]),ea=(0,r.useMemo)(()=>c&&0!==c.length?c.map(e=>({value:e.name.replace(/_1_perp$/i,""),label:e.display})):[],[c]),el=[f,b].sort().join(":"),er="".concat(h,":").concat(el);return(0,l.jsxs)("div",{className:"lg:h-full lg:flex lg:flex-col lg:overflow-hidden",children:[$&&(0,l.jsx)("div",{className:"mb-2 text-red-400 text-sm bg-error-bg border border-error-border rounded-lg p-2 shrink-0",children:$}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row gap-3 lg:gap-3.5 pb-12 lg:pb-0 lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-3 lg:gap-3.5 lg:w-3/8 lg:min-h-0",children:[(0,l.jsx)("div",{className:"lg:flex-1 lg:min-h-0 lg:overflow-visible",children:(0,l.jsx)(j,{symbol:h,exchange1:f,exchange2:b,timeframe:y,positionSize:_,executionCost:Y,displayUnit:z,availableSymbols:u,availableExchanges:ea.map(e=>({name:e.value,display:e.label})),onSimulate:()=>ee(),isSimulating:W,onSymbolChange:g,onExchange1Change:p,onExchange2Change:v,onTimeframeChange:e=>{w(e),B(!1)},onCustomRangeChange:(e,t)=>{S(e),M(t),B(!0);let a=new Date(e).toISOString(),l=new Date(t).toISOString();(!V||new Date(a)<new Date(V.start)||new Date(l)>new Date(V.end)||!q)&&ee({start:a,end:l,isCustom:!0})},onPositionSizeChange:I,onExecutionCostChange:O,onDisplayUnitChange:H,needsRefresh:null!==K&&K!==er})}),(0,l.jsx)("div",{className:"lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:(0,l.jsx)(P,{stats:(null==(t=et.simulationResult)?void 0:t.summary)?{totalPnL:et.simulationResult.summary.totalPnlUsd,totalPnLPercent:et.simulationResult.summary.totalPnlPct,totalFundingCollected:et.simulationResult.summary.fundingCollectedUsd,executionCosts:et.simulationResult.summary.executionCostsUsd,fundingPeriods:et.simulationResult.summary.numFundingPeriods,avgHourlySpread:100*et.simulationResult.summary.avgHourlySpreadPct*8}:{totalPnL:0,totalPnLPercent:0,totalFundingCollected:0,executionCosts:0,fundingPeriods:0,avgHourlySpread:0},isLoading:W,hasBothExchanges:et.hasBothExchanges,displayUnit:z})})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-3 lg:gap-3.5 lg:w-5/8 lg:min-h-0",children:[(0,l.jsx)("div",{className:"lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:(0,l.jsx)(k,{data:et.chartData,exchange1Name:f,exchange2Name:b,isLoading:W,hasBothExchanges:et.hasBothExchanges,displayUnit:z})}),(0,l.jsx)("div",{className:"lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:(0,l.jsxs)("div",{className:"bg-linear-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 lg:p-5 shadow-xl lg:h-full lg:flex lg:flex-col",children:[(0,l.jsxs)("h2",{className:"text-base lg:text-lg font-semibold text-white mb-1 shrink-0 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-primary rounded-full"}),"PnL"]}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(L,{data:(null==(a=et.simulationResult)?void 0:a.series)||[],periodPnL:et.periodPnL,longLegCumulativePnL:et.longLegCumulativePnL,shortLegCumulativePnL:et.shortLegCumulativePnL,exchange1Name:f,exchange2Name:b,isLoading:W,hasBothExchanges:et.hasBothExchanges})})]})})]})]})]})}},3011:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let l=a(2115);function r(e,t){let a=(0,l.useRef)(null),r=(0,l.useRef)(null);return(0,l.useCallback)(l=>{if(null===l){let e=a.current;e&&(a.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(a.current=n(e,l)),t&&(r.current=n(t,l))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3327:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(1847).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},3392:(e,t,a)=>{"use strict";a.d(t,{p:()=>s});var l=a(5155),r=a(2115),n=a(1433);let s=r.forwardRef((e,t)=>{let{className:a,type:r,...s}=e;return(0,l.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-[#333] bg-[#1e1e1e] px-3 py-2 text-sm text-white ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-[#666] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});s.displayName="Input"},3726:(e,t,a)=>{Promise.resolve().then(a.bind(a,2355))},4381:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(5155),r=a(1433),n=a(2115),s=a(6485);let i=[{value:"custom",label:"Custom"},{value:"4h",label:"4h"},{value:"12h",label:"12h"},{value:"1d",label:"1d"},{value:"3d",label:"3d"},{value:"7d",label:"7d"},{value:"14d",label:"14d"},{value:"30d",label:"30d"},{value:"all",label:"All"}];function o(e){var t;let a={"4h":144e5,"12h":432e5,"1d":864e5,"3d":2592e5,"7d":6048e5,"14d":12096e5,"30d":2592e6};return null!=(t=a[e])?t:a["7d"]}function d(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)}function c(e){let{value:t,onChange:a,onCustomRangeChange:c,exclude:u}=e,m=i.filter(e=>!(null==u?void 0:u.includes(e.value))),[x,h]=(0,n.useState)(!1),[g,f]=(0,n.useState)(""),[p,b]=(0,n.useState)(""),[v,y]=(0,n.useState)(!1),w=(0,n.useRef)(null),j=(0,n.useMemo)(()=>(function(e,t,a){if("custom"===e&&t&&a){let e=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"});return"".concat(e(t)," - ").concat(e(a))}if("all"===e)return"Sept 19, 2024 - Present";let l=new Date,r=new Date(l.getTime()-o(e)),n=e=>e.toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"}),s=n(r),i=n(l);return"".concat(s," - ").concat(i)})(v?"custom":t,g,p),[t,v,g,p]);return(0,n.useEffect)(()=>{function e(e){w.current&&!w.current.contains(e.target)&&h(!1)}if(x)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[x]),(0,l.jsxs)("div",{className:"relative w-full min-w-0",children:[(0,l.jsx)("div",{className:"flex w-full min-w-0",children:m.map((e,n)=>{let i="custom"===e.value?v:["4h","12h","1d","3d","7d","14d","30d","all"].includes(e.value)&&e.value===t&&!v,u=0===n,w=n===m.length-1;return(0,l.jsx)("button",{type:"button",onClick:()=>{if("custom"===e.value){if(h(!x),!g||!p){let e=new Date;f(d(new Date(e.getTime()-6048e5))),b(d(e))}}else if(["4h","12h","1d","3d","7d","30d","all"].includes(e.value)){var t;t=e.value,y(!1),a(t)}else"14d"===e.value&&(e=>{let t=new Date,a=d(new Date(t.getTime()-o(e))),l=d(t);f(a),b(l),y(!0),c&&c(a,l)})(e.value)},"aria-label":"custom"===e.value?"Custom range":"".concat(e.label," range"),className:(0,r.cn)("h-10 px-3 text-sm font-medium transition-all duration-200 focus:outline-none border inline-flex items-center justify-center gap-1 flex-1 min-w-0 whitespace-nowrap",u&&"rounded-l-md",w&&"rounded-r-md",i?"bg-primary text-black hover:bg-primary/90 z-10 border-primary shadow-sm shadow-primary/20":"bg-[#1a1a1a] text-white hover:bg-[#252a34] border-[#2a2e39]",!u&&"-ml-px"),children:"custom"===e.value?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.A,{className:"w-4 h-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Custom"})]}):e.label},e.value)})}),x&&(0,l.jsx)("div",{ref:w,className:"absolute top-full mt-2 left-0 z-50 bg-gradient-to-br from-[#1a1a1a] to-[#151515] border border-[#2a2e39] rounded-xl p-4 shadow-2xl min-w-[280px]",children:(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-xs text-[#cfd3dc] mb-1.5 font-medium",children:"Start Date"}),(0,l.jsx)("input",{type:"date",value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 bg-[#252a34] border border-[#2a2e39] rounded text-white text-sm focus:outline-none focus:border-primary"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-xs text-[#cfd3dc] mb-1.5 font-medium",children:"End Date"}),(0,l.jsx)("input",{type:"date",value:p,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 bg-[#252a34] border border-[#2a2e39] rounded text-white text-sm focus:outline-none focus:border-primary"})]}),(0,l.jsx)("button",{onClick:()=>{if(g&&p){let e=new Date(g);if(new Date(p)<e)return void alert("End date must be after start date");y(!0),h(!1),c&&c(g,p)}},className:"w-full py-2.5 bg-primary text-black font-semibold rounded-lg text-sm hover:bg-primary/90 transition-all duration-200 shadow-lg shadow-primary/20 hover:shadow-primary/40",children:"Apply"})]})}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-[#9ca3af] flex items-center gap-1.5 w-full min-w-0",children:[(0,l.jsx)(s.A,{className:"w-3 h-3 text-[#9ca3af]"}),(0,l.jsx)("span",{className:"truncate",children:j})]})]})}},9340:(e,t,a)=>{"use strict";a.d(t,{$:()=>s});var l=a(5155),r=a(2115),n=a(1433);let s=r.forwardRef((e,t)=>{let{className:a,variant:r="default",size:s="default",...i}=e;return(0,l.jsx)("button",{className:(0,n.cn)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:pointer-events-none disabled:opacity-50",{"bg-[#2a2a2a] text-white hover:bg-[#333] border border-[#444]":"default"===r,"border border-primary text-primary hover:bg-primary/10":"outline"===r,"hover:bg-[#222] hover:text-white":"ghost"===r,"bg-primary text-black hover:bg-primary/90":"primary"===r,"bg-secondary text-black hover:bg-secondary/90":"secondary"===r,"h-10 px-4 py-2":"default"===s,"h-9 rounded-md px-3":"sm"===s,"h-11 rounded-md px-8":"lg"===s,"h-10 w-10":"icon"===s},a),ref:t,...i})});s.displayName="Button"}},e=>{e.O(0,[647,586,909,239,805,441,255,358],()=>e(e.s=3726)),_N_E=e.O()}]);